#!/bin/bash

set -e

template_dir=~/.emacs.d/cpp-template

mkdir $1
cd $1
cp -r $template_dir/* .
git init
git submodule add https://github.com/google/googletest
sed -e "s/__PROJECT_NAME__/$1/g" "$template_dir/CMakeLists.txt" > CMakeLists.txt
gtags

doxygen_set() {
    echo "s~\($1 *=\).*~\1 $2~g"
}
doxygen -g - | \
    sed -e "$(doxygen_set PROJECT_NAME \"$1\")" \
        -e "$(doxygen_set OUTPUT_DIRECTORY doc)" \
        -e "$(doxygen_set INPUT .)" \
        -e "$(doxygen_set RECURSIVE YES)" \
        -e "$(doxygen_set EXCLUDE_PATTERNS */test/*\ */build/*\ */doc/*\ */googletest/*)" \
        -e "$(doxygen_set QT_AUTOBRIEF YES)" \
        -e "$(doxygen_set JAVADOC_AUTOBRIEF YES)" \
        -e "$(doxygen_set BUILTIN_STL_SUPPORT YES)" \
        > Doxyfile
doxygen
cd build
cmake -DCMAKE_BUILD_TYPE=Debug -DCMAKE_EXPORT_COMPILE_COMMANDS=1 ..
make
